# 生命周期

### 生命周期

- 编写代码
- 收集依赖 （无自动导入）
- 初始化 生成 app, 触发一次生命周期
- 根据 app controllers 属性导入新的依赖
- 依赖实例化 又一次触发一次生命周期
- 实例化结束 启动应用

begin
自动导入
依赖收集
注册实例
done

开始 / init --> auto scanner --> 依赖收集 / onCollected --> 实例化 --> 生成路由 / onRouterGenerator --> onReady

### 生命周期是谁的生命周期

### auto scanner

扫面所有匹配的文件。 默认为 src/controllers 下面的所有 ts 文件

文件被导入时触发执行装饰器（装饰器在定义时生效）

优先级
方法参数装饰器 -- 方法装饰器/属性装饰器（实例） -- 类装饰器

### 依赖收集

装饰器被执行的时候会将带有类有关的元信息存入 MetadataStorage 里面

### 元信息如何被收集

使用指定的装饰器方法
类装饰器使用 @Injectable 传入所有的类信息
方法装饰器使用 @Action
属性装饰器使用 @Property
参数装饰器 使用 @Argument
这些内置的装饰器方法会收集/创建不同的元信息到 metadata-stroage 中
允许用户传入回调用来调用、修改获取元信息

### 具体收集什么信息

#### 类

唯一标识符 -- 也会在内部的其他装饰器中创建、、因为要先执行内部的装饰器
构造函数
构造函数参数信息
其他元信息

#### 方法装饰器

方法名
对应的构造器唯一标识符
其他元信息

#### 属性装饰器

属性类型
属性名称

#### 方法参数装饰器

方法名称
对应的构造器唯一标识符
参数类型
位置
其他

### 如何使用这些元信息

收集元信息的主要目的是为了提供数据给 IOC 容器自动给我们实例化/创建我们需要的对象

### 使用这些元信息的时间点

所以如果你需要用到这些元信息可以在指定的生命周期内获取到并进行一些操作

### metadata storage

injectableMetadata --> 类装饰器元信息

actionMetadata --> 方法装饰器元信息

argumentMetadata --> 参数装饰器元信息

propertyMetadata --> 属性装饰器
